# Shelloding - Level 3

## Mission (Cloud Scale Security)
We realized half of our targets have their entire corporate infrastructure in the cloud! There's this hot new number storage service being offered by one of the major cloud providers... and it looks pretty sketchy.

If you can break into this one, it'll be a huge boost to our operation!


## Source Code

```c
// gcc -g -I ../includes -z execstack -no-pie -o 04_level_3 04_level_3.c
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

// Hidden for simplicity (get_unum)
#include "wargames.h"
#include "04_level_3.h"

#define STORAGE_SIZE 100

// Get a number from the user and store it
int store_number(unsigned int * data)
{
    unsigned int value = 0;
    unsigned int index = 0;

    // Prompt the user for a number to store
    printf(" Number: ");
    value = get_unum();

    // Prompt the user for an index to store at
    printf(" Index: ");
    index = get_unum();

    // Some slots have been reserved for the service owner :-)
    if (index % 3 == 1)
    {
        printf(" ************ ERROR ************\n");
        printf("     This index is reserved!    \n");
        printf(" ************ ERROR ************\n");

        return 1;
    }

    // Save the number to data storage
    data[index] = value;
    return 0;
}

// Returns the contents of a specified storage index
int read_number(unsigned int * data)
{
    unsigned int index = 0;

    // Get index to read from
    printf(" Index: ");
    index = get_unum();

    printf(" Number at data[%u] is %u\n", index, data[index]);
    return 0;
}

void main()
{
    init_wargame();

    printf("------------------------------------------------------------\n");
    printf("--[ Shellcode Level #3 - Number Storage v1.0                \n");
    printf("------------------------------------------------------------\n");

	int result = 0;
    char cmd[20] = {};
    unsigned int data[STORAGE_SIZE] = {};

    printf("\n");
    printf("  +------------------------------------------------------+\n"\
           "  | Welcome to the ~ C L O U D ~ number storage service! |\n"\
           "  +------------------------------------------------------+\n"\
           "  |  Commands:                                           |\n"\
           "  |     store - store a number into the data storage     |\n"\
           "  |     read  - read a number from the data storage      |\n"\
           "  |     quit  - exit the program                         |\n"\
           "  +------------------------------------------------------+\n"\
           "  |  The owner has reserved some storage for himself :-) |\n"\
           "  +------------------------------------------------------+\n"\
           "\n");

    // Command handler loop
    while (1)
    {
        result = 1;

        // Prompt the user for a new command
        printf("Input command: ");
        fgets(cmd, sizeof(cmd), stdin);
		cmd[strcspn(cmd, "\n")] = 0;

        // Handle the specified user command
        if (!strncmp(cmd, "store", 5))
            result = store_number(data);
        else if (!strncmp(cmd, "read", 4))
            result = read_number(data);
        else if (!strncmp(cmd, "quit", 4))
            break;

        // Print the result of the user action
        if (result)
            printf(" Failed to do %s command\n", cmd);
        else
            printf(" Completed %s command successfully\n", cmd);

        memset(cmd, 0, sizeof(cmd));
    }

    // Exit the program / return from main
}

```

## Static Analysis

TODO
