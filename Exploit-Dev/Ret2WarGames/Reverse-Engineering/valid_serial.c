#include <stdio.h>
#include <stdlib.h>
#include <string.h>


valid_serial(char buffer[], int ser) {
   int i = 0;
   char ** x;
   unsigned int serialOut = 0;

    for (i=0; i <=4; i++) {
        // serialOut += (unsigned long int)(&buffer);
        x = &buffer + (i % strlen(buffer));
        printf("DEBUG: Address of Name buffer = %p\n", &buffer);
        printf("DEBUG: Address of x (buffer: %p + remainder: %lu) = %p\n", 
                &buffer, (i % strlen(buffer)) , x);
   }
   
    printf("\n");
    printf("Serial: %d \n", ser);
    printf("Generated number from Name: %d \n", serialOut);
    printf("DEBUG: Address of Name buffer = %p\n", &buffer);
    printf("DEBUG: Address of x = %p\n", &x);
    printf("DEBUG: Contents of Name buffer = %s\n", buffer);

   return serialOut == ser;
}


void main()
{
    char buffer[64] = {};
    unsigned int serial;

    printf("------------------------------------------------------------\n");
    printf("--[ Reverse Engineering Level #1 - Serial Crackme           \n");
    printf("------------------------------------------------------------\n");

    // prompt the user for their name
    printf("Enter your name: ");
    fgets(buffer, sizeof(buffer), stdin);
    buffer[strcspn(buffer, "\n")] = 0;     // strip newline

    // if no name was given, abort
    if(strlen(buffer) == 0)
    {
        printf("Invalid name...\n");
        exit(1);
    }

    // prompt the user for a valid serial number
    printf("Enter serial number: ");
    scanf("%u", &serial);
    printf("------------------------------------------------------------\n");

    // check the serial number for correctness
    if(!valid_serial(buffer, serial))
    {
        printf("Invalid serial number...\n");
        exit(1);
    }

    printf("Serial number accepted!\n");
    system("cat flag");

}


